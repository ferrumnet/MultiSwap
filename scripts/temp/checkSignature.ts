import { ethers, keccak256, id, TypedDataEncoder } from "ethers";
import hre from "hardhat";
import addresses from "../../constants/addresses.json"
import fiberRouterAbi from "../../artifacts/contracts/multiswap-contracts/FiberRouter.sol/FiberRouter.json"

// RPC endpoint URL
const rpcUrl = "https://base-mainnet.core.chainstack.com/e7aa01c976c532ebf8e2480a27f18278";

// Create a provider
const provider = new ethers.JsonRpcProvider(rpcUrl);
const privateKey = process.env.PRIVATE_GAS_ESTIMATION!;
const wallet = new ethers.Wallet(privateKey, provider);

async function sendTransaction() {

    const fiberRouterAddress = "0xFFa29E1391B1aC1C42d1C52Aa699771Dd2138b66"

    const fiberRouter = new hre.ethers.Contract(
        fiberRouterAddress,
        fiberRouterAbi.abi,
        wallet
    )

    console.log(fiberRouter.interface.parseTransaction({
        data: "0xb43d2a4d0000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000c7c60000000000000000000000009f6abbf0ba6b5bfa27f4deb6597cc6ec20573fda000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e5831000000000000000000000000111111125421ca6dc452d289314280a0f8842a6500000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000002105000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000cebb7265ed625f8df2336c00d0ec6656bea9e6bbe6f88cfe0ee3829feb95602e4a778a72d2cdba818c6d7a4ebdda457b07dba53d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000002a807ed2379000000000000000000000000e37e799d5077682fa0a244d46e5649f71457bd090000000000000000000000009f6abbf0ba6b5bfa27f4deb6597cc6ec20573fda000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e58310000000000000000000000003fec70f319a4145eba17765ae0c64b2232fe5bae000000000000000000000000ffa29e1391b1ac1c42d1c52aa699771dd2138b660000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000000c7c600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000015800000000000000000000000000000000000000000000013a00010c00001a0020d6bdbf789f6abbf0ba6b5bfa27f4deb6597cc6ec20573fda00a007e5c0d20000000000000000000000000000000000000000000000000000ce00006700206ae4071138002dc6c03fec70f319a4145eba17765ae0c64b2232fe5baedb86e7fe4074e3c29d2fd0ed1d104c00e11a196b00000000000000000000000000000000000000000000000000000000000000019f6abbf0ba6b5bfa27f4deb6597cc6ec20573fda00206ae40711b8002625a0db86e7fe4074e3c29d2fd0ed1d104c00e11a196b111111125421ca6dc452d289314280a0f8842a65000000000000000000000000000000000000000000000000000000000000000182af49447d8a07e3bd95bd0d56f35241523fbab10020d6bdbf78af88d065e77c8cc2239327c5edb3a432268e5831111111125421ca6dc452d289314280a0f8842a6500000000000000007c2ad3dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080408c936d1abc6ce81c6956d321e2227d143bbce7082b6edc0a27e65d43182df900000000000000000000000000000000000000000000000000000000663d2e2600000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004125488c0cc7a26597008d2be1913341abc50d1ce0baf7f40314e37212ceea635f47efe644e04bb4efeaa8cf5c330ec583a0aa03d668b5281551c09eb1ed13763c1c00000000000000000000000000000000000000000000000000000000000000"
    }))


    const domain = {
        name: "FEE_DISTRIBUTOR",
        version: "000.001",
        chainId: 42161,
        verifyingContract: fiberRouterAddress
    };

    const types = {
        FeeAllocation: [
            { name: "recipient", type: "address" },
            { name: "rateInBps", type: "uint16" }
        ],
        DistributeFees: [
            { name: "token", type: "address" },
            { name: "feeAllocations", type: "FeeAllocation[]" },
            { name: "salt", type: "bytes32" },
            { name: "expiry", type: "uint256" }
        ],
    };

    const values = {
        token: "0xaf88d065e77c8cC2239327C5EDb3A432268e5831",
        feeAllocations: [],
        salt: "0x408c936d1abc6ce81c6956d321e2227d143bbce7082b6edc0a27e65d43182df9",
        expiry: "1715285542"
    };
    const signature = await wallet.signTypedData(domain, types, values)
    console.log("sig: " + signature)

    const encoder = new TypedDataEncoder(types)
    console.log(encoder.encode(values))
}

sendTransaction();
